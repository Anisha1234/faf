{% extends "base.html" %}

{% block title %}Report #{{ report.id }}{% endblock %}

{% block submenu_append %}
  <li class='active'>
    <a href=''>Report #{{ report.id }}</a>
  </li>
{% endblock %}

{% block js %}
  <script type="text/javascript" src="/js/flot/jquery.flot.js"></script>
  <script type="text/javascript" src="/js/flot/jquery.flot.pie.js"></script>
{% endblock %}

{% block content %}
  <div class='report'>
    <div class='row'>
      <div class='span6'>
        <h3>Info</h3>
        <dl class='dl-horizontal'>
          <dt>Problem</dt>
          <dd>
            {% if report.problem_id %}
              <a href='{% url pyfaf.hub.problems.views.summary report.problem_id %}'
                >{{ report.problem_id }}</a>
            {% else %}
              <em>An owning problem doesn't exist yet.</em>
            {% endif %}
          </dd>
          <dt>Component</dt>
          <dd>{{ component.name }}</dd>
          <dt>Created</dt>
          <dd>{{ report.first_occurence|date:"Y-m-d" }}</dd>
          <dt>Last change</dt>
          <dd>{{ report.last_occurence|date:"Y-m-d" }}</dd>
        </dl>
        {% if releases|length > 1 or arches|length > 1 %}
          <h3>Graphs</h3>
          <div class='row'>
            <div id="release_graph" class="span3 graph"></div>
            <div id="arch_graph" class="span3 graph"></div>
          </div>
          <script>
            var release_data = [];
            {% for release in releases %}
              release_data.push( {
                label: "{{ release.OpSys.name }} {{ release.OpSysRelease.version }}",
                data: {{ release.ReportOpSysRelease.count }}, } );
            {% endfor %}


            var arch_data = [];
            {% for arch in arches %}
              arch_data.push( {
                label: "{{ arch.arch.name }}",
                data: {{ arch.count }}, } );
            {% endfor %}

            var pie_chart_options =  {
                series: {
                  pie: {
                    show: true,
                  },
                },
              }

            {% if releases|length > 1 %}
              $.plot($('#release_graph'), release_data, pie_chart_options);
            {% endif %}
            {% if arches|length > 1 %}
              $.plot($('#arch_graph'), arch_data, pie_chart_options);
            {% endif %}
          </script>
        {% endif %}
      </div>
      <div class='span6 statistics'>
        <h3>Statistics</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Operating system</th>
            <th>Count</th>
          </tr>
          {% for release in releases %}
          <tr>
            <td>{{ release.OpSys.name }} {{ release.OpSysRelease.version }}</td>
            <td>{{ release.ReportOpSysRelease.count }}</td>
          </tr>
          {% endfor %}
        </table>

        <table class="table table-striped table-bordered">
          <tr>
            <th>Architecture</th>
            <th>Count</th>
          </tr>
          {% for arch in arches %}
          <tr>
            <td>{{ arch.arch.name }}</td>
            <td>{{ arch.count }}</td>
          </tr>
          {% endfor %}
        </table>

        {% with crashed_packages as packages %}
          {% if packages %}
            <h4>Packages</h4>
            {% include 'reports/packages.html' %}
          {% endif %}
        {% endwith %}

        {% with related_packages as packages %}
          {% if packages %}
            <h4>Related packages</h4>
            {% include 'reports/packages.html' %}
          {% endif %}
        {% endwith %}
      </div>
    </div>

    <div class='row'>
      <div class='span12'>
        <h3>History</h3>
      </div>
      <div class='span4'>
        <h4>Daily:</h4>
        {% with daily_history as history %}
          {% with 'daily' as datefmt %}
            {% include 'reports/history_graph.html' %}
          {% endwith %}
        {% endwith %}
      </div>

      <div class='span4'>
        <h4>Weekly:</h4>
        {% with weekly_history as history %}
          {% with 'weekly' as datefmt %}
            {% include 'reports/history_graph.html' %}
          {% endwith %}
        {% endwith %}
      </div>

      <div class='span4'>
        <h4>Monthly:</h4>
        {% with monthly_history as history %}
          {% with 'monthly' as datefmt %}
            {% include 'reports/history_graph.html' %}
          {% endwith %}
        {% endwith %}
      </div>
    </div>

    <br />

    <h3>Backtrace</h3>
    {% with report.type as type %}
      {% include 'reports/backtrace.html' %}
    {% endwith %}

  </div>
{% endblock %}
