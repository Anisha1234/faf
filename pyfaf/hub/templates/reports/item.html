{% extends "base.html" %}

{% block title %}Report #{{ report.0.id }}{% endblock %}

{% block content %}
  <div id='report'>
    <h2>Report details.</h2>
    <dl>
      <dt>ID</dt>
      <dd>{{report.0.id}}</dd>
      <dt>Problem</dt>
      <dd>
        {% if report.0.problem_id %}
          <a href='{% url pyfaf.hub.problems.views.summary report.0.problem_id %}'
            >{{report.0.problem_id}}</a>
        {% else %}
          <em>An owning problem doesn't exist yet.</em>
        {% endif %}
      </dd>
      <dt>Component</dt>
      <dd>{{report.1.name}}</dd>
      <dt>Operating System</dt>
      <dd>{{report.2.name}}</dd>
      <dt>Created</dt>
      <dd>{{report.0.first_occurence|date:"Y-m-d"}}</dd>
      <dt>Last change</dt>
      <dd>{{report.0.last_occurence|date:"Y-m-d"}}</dd>
    </dl>

    <br />

    <table class="table table-striped table-bordered packages">
      <thead>
        <tr>
          <th></th>
          <th collspan='5'>
            Packages
          </th>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Installed</th>
          <th>Running</th>
          <th>Count</th>
        </tr>
      </thead>
      <tbody>
        {% for package in packages %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              {% if package.iname != None %}
                {{package.iname}}
              {% else %}
                {{package.rname}}
              {% endif %}
            </td>
            <td>
              {% if package.iversion != None %}
                {{package.iepoch}}:{{package.iversion}}-{{package.irelease}}
              {% endif %}
            </td>
            <td>
              {% if package.rversion != None %}
                {{package.repoch}}:{{package.rversion}}-{{package.rrelease}}
              {% endif %}
            </td>
            <td>{{package.count}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <table class="table table-striped table-bordered packages">
      <thead>
        <tr>
          <th></th>
          <th collspan='5'>
            Related packages
          </th>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Installed</th>
          <th>Running</th>
          <th>Count</th>
        </tr>
      </thead>
      <tbody>
        {% for package in related_packages %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              {% if package.iname != None %}
                {{package.iname}}
              {% else %}
                {{package.rname}}
              {% endif %}
            </td>
            <td>
              {% if package.iversion != None %}
                {{package.iepoch}}:{{package.iversion}}-{{package.irelease}}
              {% endif %}
            </td>
            <td>
              {% if package.rversion != None %}
                {{package.repoch}}:{{package.rversion}}-{{package.rrelease}}
              {% endif %}
            </td>
            <td>{{package.count}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <br />

    <div class='row'>
      <div class='span12'>
        <h3>History</h3>
      </div>
      <div class='span4'>
        <h4>Daily:</h4>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Day</th>
            <th>Count</th>
          </tr>
          {% for hist in daily_history %}
            <tr>
              <td>{{hist.day|date:"c"}}</td>
              <td>{{hist.count}}</td>
            </tr>
          {% endfor %}
        </table>
      </div>

      <div class='span4'>
        <h4>Weekly:</h4>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Day</th>
            <th>Count</th>
          </tr>
          {% for hist in weekly_history %}
            <tr>
              <td>{{hist.week|date:"c (W.)"}}</td>
              <td>{{hist.count}}</td>
            </tr>
          {% endfor %}
        </table>
      </div>

      <div class='span4'>
        <h4>Monthly:</h4>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Day</th>
            <th>Count</th>
          </tr>
          {% for hist in monthly_history %}
            <tr>
              <td>{{hist.month|date:"Y-m"}}</td>
              <td>{{hist.count}}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
    </div>

    <br />

    <h3>Backtrace</h3>
    <table class="table table-striped table-bordered">
      <tr>
        <th>Frame #</th>
        <th>Function</th>
        <th>Binary</th>
        <th>Source</th>
        <th>Line</th>
      </tr>
      {% for frame in backtrace %}
        <tr>
          <td>{{ frame.order }}</td>
          <td>{{ frame.symbolsource.symbol.name }}</td>
          <td>{{ frame.symbolsource.path }}</td>
          <td>{{ frame.symbolsource.source_path }}</td>
          <td>{{ frame.symbolsource.line_number }}</td>
        </tr>
      {% endfor %}
    </table>
  </div>
{% endblock %}
